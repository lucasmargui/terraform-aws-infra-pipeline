# name: Terraform CI/CD

# on:
#   workflow_dispatch:
#     inputs:
#       apply:
#         description: 'Executar o terraform apply?'
#         required: true
#         default: 'false'
#         type: choice
#         options:
#           - true
#           - false

#       destroy:
#         description: 'Destruir ambiente?'
#         required: true
#         default: 'false'
#         type: choice
#         options:
#           - true
#           - false

#       plan_destroy:
#         description: 'Planejar o destroy?'
#         required: true
#         default: 'false'
#         type: choice
#         options:
#           - true
#           - false

# permissions:
#   id-token: write
#   contents: read

# jobs:
#   terraform:
#     name: Terraform Automation
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout
#         uses: actions/checkout@v5.0.0

#       - name: "Configure AWS Credentials"
#         uses: aws-actions/configure-aws-credentials@v4.3.1
#         with:
#           role-to-assume: <sua-role-aqui>
#           aws-region: <sua-regiao-aqui>

#       - name: HashiCorp - Setup Terraform
#         uses: hashicorp/setup-terraform@v3.1.2

#       - name: Terraform Init (bootstrap)
#         working-directory: ./bootstrap
#         run: terraform init

#       - name: Terraform Apply (bootstrap)
#         working-directory: ./bootstrap
#         run: terraform apply -auto-approve
        
#       - name: Terraform Init (infra)
#         working-directory: ./infrastructure
#         run: terraform init -migrate-state

#       - name: Terraform Validate
#         working-directory: ./infrastructure
#         run: terraform validate

#       - name: Terraform Plan
#         working-directory: ./infrastructure
#         run: terraform plan -out=tfplan

#       - name: Terraform Apply
#         working-directory: ./infrastructure
#         run: terraform apply -auto-approve tfplan
#         if: github.event.inputs.apply == 'true'

#       - name: Plan Destroy
#         working-directory: ./infrastructure
#         run: terraform plan -destroy -out=tfplandestroy
#         if: github.event.inputs.plan_destroy == 'true'

#       - name: Terraform Destroy
#         working-directory: ./infrastructure
#         run: terraform apply -destroy -auto-approve tfplandestroy
#         if: github.event.inputs.destroy == 'true'
